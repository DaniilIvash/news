<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="UTF-8">
    <title th:text="${title}">–û–Ω–ª–∞–π–Ω-–Ω–æ–≤–æ—Å—Ç–∏</title>
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            color: #333;
            background: linear-gradient(to bottom, #87CEEB, #CD7F32);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .header {
            background: linear-gradient(to bottom, rgba(44, 62, 80, 0.9), rgba(44, 62, 80, 0.5));
            color: white;
            padding: 1rem 2rem;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo {
            height: 60px;
            width: auto;
        }

        .site-title {
            font-size: 1.8rem;
            font-weight: bold;
            margin: 0;
            font-family: 'Times New Roman', Times, serif;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
        }

        .menu-button {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .menu-button span {
            display: block;
            width: 25px;
            height: 3px;
            background-color: white;
        }

        .auth-button {
            background: none;
            border: 1px solid white;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: background-color 0.3s;
        }

        .auth-button:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: 10px;
            color: white;
            font-size: 0.9rem;
            cursor: pointer;
        }

        .user-profile:hover {
            opacity: 0.8;
        }

        .user-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background-color: #3498db;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .logout-button {
            background: none;
            border: 1px solid white;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: background-color 0.3s;
        }

        .logout-button:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .menu {
            position: fixed;
            top: 60px;
            right: 20px;
            background-color: rgba(44, 62, 80, 0.9);
            color: white;
            padding: 1rem;
            border-radius: 5px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
            display: none;
            z-index: 1001;
            width: 200px;
        }

        .menu.show {
            display: block;
        }

        .menu-item {
            padding: 0.5rem;
            cursor: pointer;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }

        .menu-item:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 1002;
            justify-content: center;
            align-items: center;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background-color: white;
            padding: 2rem;
            border-radius: 10px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-content h2 {
            margin-top: 0;
            color: #2c3e50;
        }

        .close-button {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
        }

        .select-container {
            margin-bottom: 1rem;
        }

        .select-container select {
            padding: 0.5rem;
            width: 100%;
            border-radius: 5px;
            border: 1px solid #ccc;
        }

        .chart-container {
            height: 300px;
            margin-bottom: 1rem;
        }

        .news-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            padding: 4rem 1.5rem 2rem;
            gap: 1.5rem;
            margin-top: 60px;
            flex: 1;
        }

        .news-card {
            background: linear-gradient(to bottom, #F5F5DC, #E0C097);
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            padding: 1.5rem;
            width: 350px;
            transition: transform 0.3s, box-shadow 0.3s;
            border: 1px solid #E0C097;
        }

        .news-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.15);
        }

        .news-card h3 {
            margin-top: 0;
            color: #2c3e50;
            font-size: 1.2rem;
        }

        .news-meta {
            color: #7f8c8d;
            font-size: 0.85rem;
            margin-bottom: 0.75rem;
        }

        .news-card p {
            color: #555;
            line-height: 1.5;
        }

        .news-card a {
            color: #3498db;
            text-decoration: none;
            font-weight: bold;
            display: inline-block;
            margin-top: 0.75rem;
        }

        .news-card a:hover {
            text-decoration: underline;
            color: #2980b9;
        }

        footer {
            background-color: rgba(44, 62, 80, 0.9);
            color: white;
            text-align: center;
            padding: 1.5rem;
            margin-top: auto;
        }

        .footer-links {
            display: flex;
            justify-content: center;
            gap: 1.5rem;
            margin-top: 0.5rem;
        }

        .footer-links a {
            color: white;
            text-decoration: none;
        }

        .footer-links a:hover {
            text-decoration: underline;
        }

        .auth-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 1003;
            justify-content: center;
            align-items: center;
        }

        .auth-modal.show {
            display: flex;
        }

        .auth-modal-content {
            background-color: white;
            padding: 2rem;
            border-radius: 10px;
            max-width: 400px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
        }

        .auth-modal-content h2 {
            margin-top: 0;
            color: #2c3e50;
            text-align: center;
        }

        .auth-tabs {
            display: flex;
            margin-bottom: 1.5rem;
            border-bottom: 1px solid #ddd;
        }

        .auth-tab {
            flex: 1;
            padding: 0.75rem;
            text-align: center;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            color: #7f8c8d;
        }

        .auth-tab.active {
            color: #2c3e50;
            border-bottom: 2px solid #3498db;
        }

        .auth-form {
            display: none;
        }

        .auth-form.active {
            display: block;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: #2c3e50;
        }

        .form-group input {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
        }

        .form-group input:focus {
            border-color: #3498db;
            outline: none;
        }

        .submit-button {
            width: 100%;
            padding: 0.75rem;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 1rem;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .submit-button:hover {
            background-color: #2980b9;
        }

        .switch-auth {
            text-align: center;
            margin-top: 1rem;
            color: #7f8c8d;
        }

        .switch-auth a {
            color: #3498db;
            text-decoration: none;
        }

        .switch-auth a:hover {
            text-decoration: underline;
        }

        .update-button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9rem;
            margin-top: 1rem;
            transition: background-color 0.3s;
        }

        .update-button:hover {
            background-color: #2980b9;
        }

        .date-filter-container {
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            padding: 1.5rem;
            margin: 3rem auto 1rem;
            max-width: 800px;
        }

        .filter-group {
            display: flex;
            align-items: center;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .filter-label {
            font-weight: bold;
            color: #2c3e50;
            font-size: 1.1rem;
        }

        .filter-select {
            padding: 0.6rem 1rem;
            border-radius: 5px;
            border: 1px solid #ddd;
            background-color: white;
            font-size: 1rem;
            min-width: 150px;
            transition: border-color 0.3s;
        }

        .filter-select:focus {
            border-color: #3498db;
            outline: none;
        }
    </style>
</head>
<body>
<div class="header">
    <div class="header-left">
        <img src="/logo.png" alt="–õ–æ–≥–æ—Ç–∏–ø" class="logo">
        <div class="site-title">–û–Ω–ª–∞–π–Ω –ù–æ–≤–æ—Å—Ç–∏</div>
    </div>
    <div class="header-right" id="headerRight">
        <!-- –ö–Ω–æ–ø–∫–∏ –≤—Ö–æ–¥–∞ –∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –∏–ª–∏ –∑–∞–º–µ–Ω–µ–Ω—ã –Ω–∞ –ø—Ä–æ—Ñ–∏–ª—å —á–µ—Ä–µ–∑ JavaScript -->
    </div>
</div>

<div class="menu" id="menu">
    <div class="menu-item" onclick="openModal('currency')">–ö—É—Ä—Å –≤–∞–ª—é—Ç</div>
    <div class="menu-item" onclick="openModal('weather')">–ü—Ä–æ–≥–Ω–æ–∑ –ø–æ–≥–æ–¥—ã</div>
    <div class="menu-item" onclick="filterNews('–°–ø–æ—Ä—Ç')">–°–ø–æ—Ä—Ç</div>
    <div class="menu-item" onclick="filterNews('–≠–∫–æ–Ω–æ–º–∏–∫–∞')">–≠–∫–æ–Ω–æ–º–∏–∫–∞</div>
    <div class="menu-item" onclick="filterNews('–ü–æ–ª–∏—Ç–∏–∫–∞')">–ü–æ–ª–∏—Ç–∏–∫–∞</div>
    <div class="menu-item" onclick="filterNews('–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏')">–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏</div>
    <div class="menu-item" onclick="filterNews('–ù–∞—É–∫–∞')">–ù–∞—É–∫–∞</div>
    <div class="menu-item" onclick="filterNews('–û–±—â–µ—Å—Ç–≤–æ')">–û–±—â–µ—Å—Ç–≤–æ</div>
    <div class="menu-item" onclick="filterNews('–ö—É–ª—å—Ç—É—Ä–∞')">–ö—É–ª—å—Ç—É—Ä–∞</div>
    <div class="menu-item" onclick="filterNews('–≠–∫–æ–ª–æ–≥–∏—è')">–≠–∫–æ–ª–æ–≥–∏—è</div>
    <div class="menu-item" onclick="filterNews('–û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ')">–û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ</div>
    <div class="menu-item" onclick="filterNews('')">–í—Å–µ –Ω–æ–≤–æ—Å—Ç–∏</div>
</div>

<div class="modal" id="currencyModal">
    <div class="modal-content">
        <button class="close-button" onclick="closeModal('currency')">&times;</button>
        <h2>–ö—É—Ä—Å –≤–∞–ª—é—Ç</h2>
        <div class="select-container">
            <select id="currencySelect" onchange="updateCurrencyData()">
                <option value="USD">–î–æ–ª–ª–∞—Ä –°–®–ê (USD)</option>
                <option value="EUR">–ï–≤—Ä–æ (EUR)</option>
                <option value="GBP">–ë—Ä–∏—Ç–∞–Ω—Å–∫–∏–π —Ñ—É–Ω—Ç (GBP)</option>
                <option value="CNY">–ö–∏—Ç–∞–π—Å–∫–∏–π —é–∞–Ω—å (CNY)</option>
            </select>
        </div>
        <div id="currencyData">
            <p id="currencyDate">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</p>
            <p>USD: <span id="usdRate">–ó–∞–≥—Ä—É–∑–∫–∞...</span></p>
            <p>EUR: <span id="eurRate">–ó–∞–≥—Ä—É–∑–∫–∞...</span></p>
            <p>GBP: <span id="gbpRate">–ó–∞–≥—Ä—É–∑–∫–∞...</span></p>
            <p>CNY: <span id="cnyRate">–ó–∞–≥—Ä—É–∑–∫–∞...</span></p>
        </div>
        <button onclick="updateCurrencyData()" class="update-button">–û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ</button>
    </div>
</div>

<div class="modal" id="weatherModal">
    <div class="modal-content">
        <button class="close-button" onclick="closeModal('weather')">&times;</button>
        <h2>–ü—Ä–æ–≥–Ω–æ–∑ –ø–æ–≥–æ–¥—ã</h2>
        <div class="select-container">
            <select id="citySelect" onchange="updateWeatherData()">
                <option value="moscow">–ú–æ—Å–∫–≤–∞</option>
                <option value="spb">–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥</option>
                <option value="novosibirsk">–ù–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫</option>
                <option value="yekaterinburg">–ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥</option>
            </select>
        </div>
        <div id="weatherData">
            <p id="weatherDate">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</p>
            <p>–ú–æ—Å–∫–≤–∞: <span id="moscowWeather">–ó–∞–≥—Ä—É–∑–∫–∞...</span></p>
            <p>–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥: <span id="spbWeather">–ó–∞–≥—Ä—É–∑–∫–∞...</span></p>
            <p>–ù–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫: <span id="novosibirskWeather">–ó–∞–≥—Ä—É–∑–∫–∞...</span></p>
            <p>–ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥: <span id="yekaterinburgWeather">–ó–∞–≥—Ä—É–∑–∫–∞...</span></p>
        </div>
        <button onclick="updateWeatherData()" class="update-button">–û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ</button>
    </div>
</div>

<div class="auth-modal" id="authModal">
    <div class="auth-modal-content">
        <button class="close-button" onclick="closeAuthModal()">&times;</button>
        <h2 id="authModalTitle">–í—Ö–æ–¥</h2>
        <div class="auth-tabs">
            <div class="auth-tab active" onclick="showAuthTab('login')">–í—Ö–æ–¥</div>
            <div class="auth-tab" onclick="showAuthTab('register')">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</div>
        </div>
        <form id="loginForm" class="auth-form active" onsubmit="handleLogin(event)">
            <div class="form-group">
                <label for="loginEmail">Email</label>
                <input type="email" id="loginEmail" required>
            </div>
            <div class="form-group">
                <label for="loginPassword">–ü–∞—Ä–æ–ª—å</label>
                <input type="password" id="loginPassword" required>
            </div>
            <button type="submit" class="submit-button">–í–æ–π—Ç–∏</button>
            <div class="switch-auth">
                –ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞? <a onclick="showAuthTab('register')">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</a>
            </div>
        </form>
        <form id="registerForm" class="auth-form" onsubmit="handleRegister(event)">
            <div class="form-group">
                <label for="registerName">–ò–º—è</label>
                <input type="text" id="registerName" required>
            </div>
            <div class="form-group">
                <label for="registerEmail">Email</label>
                <input type="email" id="registerEmail" required>
            </div>
            <div class="form-group">
                <label for="registerPassword">–ü–∞—Ä–æ–ª—å</label>
                <input type="password" id="registerPassword" required>
            </div>
            <div class="form-group">
                <label for="registerConfirmPassword">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å</label>
                <input type="password" id="registerConfirmPassword" required>
            </div>
            <button type="submit" class="submit-button">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
            <div class="switch-auth">
                –£–∂–µ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç? <a onclick="showAuthTab('login')">–í–æ–π—Ç–∏</a>
            </div>
        </form>
    </div>
</div>

<div class="news-container">
    <div class="news-card" th:each="news : ${newsList}">
        <h3 th:text="${news.title}">–ù–æ–≤–æ—Å—Ç—å</h3>
        <div class="news-meta">
            <span th:text="${news.category}">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</span> ‚Ä¢
            <span th:text="${news.date}">–î–∞—Ç–∞</span>
        </div>
        <p th:text="${#strings.abbreviate(news.text, 120)}">–¢–µ–∫—Å—Ç –Ω–æ–≤–æ—Å—Ç–∏</p>
        <a th:href="@{/news/{id}(id=${news.id})}" class="news-link">–ß–∏—Ç–∞—Ç—å –¥–∞–ª—å—à–µ</a>
    </div>
</div>

<div class="date-filter-container" style="margin: 3rem auto 1rem; max-width: 800px; padding: 0 1rem;">
    <div class="filter-group" style="display: flex; align-items: center; gap: 1rem; flex-wrap: wrap;">
        <div class="filter-label" style="font-weight: bold; color: #2c3e50;">–§–∏–ª—å—Ç—Ä –ø–æ –¥–∞—Ç–µ:</div>
        <select id="dateFilter" onchange="filterNewsByDate()" class="filter-select" style="
            padding: 0.5rem 1rem;
            border-radius: 5px;
            border: 1px solid #ddd;
            background-color: white;
            font-size: 1rem;
            min-width: 150px;
        ">
            <option value="all">–í—Å–µ –¥–∞—Ç—ã</option>
            <option value="today">–°–µ–≥–æ–¥–Ω—è</option>
            <option value="week">–ó–∞ –Ω–µ–¥–µ–ª—é</option>
            <option value="month">–ó–∞ –º–µ—Å—è—Ü</option>
            <option value="year">–ó–∞ –≥–æ–¥</option>
        </select>
    </div>
</div>


<footer>
    <p>¬© 2026 –û–Ω–ª–∞–π–Ω-–Ω–æ–≤–æ—Å—Ç–∏. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.</p>
    <div class="footer-links">
        <a th:href="@{/about}">–û —Å–∞–π—Ç–µ</a>
        <a th:href="@{/contacts}">–ö–æ–Ω—Ç–∞–∫—Ç—ã</a>
        <a th:href="@{/policy}">–ü–æ–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏</a>
    </div>
</footer>

<script>
    // === 1. –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –∏ –ø—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ===
    let currentUser = null;

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ö–µ–¥–µ—Ä–∞ –¥–ª—è –≥–æ—Å—Ç—è
    function updateHeaderForGuest() {
        const headerRight = document.getElementById('headerRight');
        if (headerRight) {
            headerRight.innerHTML = `
                <button class="auth-button" id="loginButton">–í—Ö–æ–¥</button>
                <button class="auth-button" id="registerButton">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
                <button class="menu-button" id="menuButton">
                    <span></span><span></span><span></span>
                </button>
            `;
            // –ù–∞–∑–Ω–∞—á–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
            document.getElementById('loginButton')?.addEventListener('click', () => showAuthModal('login'));
            document.getElementById('registerButton')?.addEventListener('click', () => showAuthModal('register'));
            document.getElementById('menuButton')?.addEventListener('click', toggleMenu);
        }
    }

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ö–µ–¥–µ—Ä–∞ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    function updateHeaderForUser() {
        const headerRight = document.getElementById('headerRight');
        if (headerRight) {
            headerRight.innerHTML = `
                <div class="user-profile" id="userProfile">
                    <div class="user-avatar">${currentUser.name.charAt(0).toUpperCase()}</div>
                    <span>${currentUser.name}</span>
                </div>
                <button class="logout-button" id="logoutButton">–í—ã—Ö–æ–¥</button>
                <button class="menu-button" id="menuButton">
                    <span></span><span></span><span></span>
                </button>
            `;
            // –ù–∞–∑–Ω–∞—á–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
            document.getElementById('logoutButton')?.addEventListener('click', handleLogout);
            document.getElementById('menuButton')?.addEventListener('click', toggleMenu);
        }
    }

    // –ü–æ–∫–∞–∑–∞—Ç—å/—Å–∫—Ä—ã—Ç—å –º–µ–Ω—é
    function toggleMenu() {
        const menu = document.getElementById('menu');
        if (menu) menu.classList.toggle('show');
    }

    // –ü–æ–∫–∞–∑–∞—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
    function showAuthModal(tab) {
        const authModal = document.getElementById('authModal');
        if (authModal) {
            authModal.classList.add('show');
            showAuthTab(tab);
        }
    }

    // –ó–∞–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
    function closeAuthModal() {
        const authModal = document.getElementById('authModal');
        if (authModal) authModal.classList.remove('show');
    }

    // –ü–æ–∫–∞–∑–∞—Ç—å –≤–∫–ª–∞–¥–∫—É "–í—Ö–æ–¥" –∏–ª–∏ "–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è"
    function showAuthTab(tab) {
        const loginForm = document.getElementById('loginForm');
        const registerForm = document.getElementById('registerForm');
        const loginTab = document.querySelector('.auth-tab:nth-child(1)');
        const registerTab = document.querySelector('.auth-tab:nth-child(2)');

        if (tab === 'login') {
            loginForm?.classList.add('active');
            registerForm?.classList.remove('active');
            loginTab?.classList.add('active');
            registerTab?.classList.remove('active');
            document.getElementById('authModalTitle').textContent = '–í—Ö–æ–¥';
        } else {
            loginForm?.classList.remove('active');
            registerForm?.classList.add('active');
            loginTab?.classList.remove('active');
            registerTab?.classList.add('active');
            document.getElementById('authModalTitle').textContent = '–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è';
        }
    }

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Ö–æ–¥–∞
    function handleLogin(event) {
        event.preventDefault();
        const email = document.getElementById('loginEmail').value;
        const password = document.getElementById('loginPassword').value;
        const users = JSON.parse(localStorage.getItem('users')) || [];
        const user = users.find(u => u.email === email && u.password === password);

        if (user) {
            currentUser = user;
            localStorage.setItem('currentUser', JSON.stringify(currentUser));
            updateHeaderForUser();
            closeAuthModal();
            alert('–í—ã —É—Å–ø–µ—à–Ω–æ –≤–æ—à–ª–∏ –≤ —Å–∏—Å—Ç–µ–º—É!');
        } else {
            alert('–ù–µ–≤–µ—Ä–Ω—ã–π email –∏–ª–∏ –ø–∞—Ä–æ–ª—å!');
        }
    }

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
    function handleRegister(event) {
        event.preventDefault();
        const name = document.getElementById('registerName').value;
        const email = document.getElementById('registerEmail').value;
        const password = document.getElementById('registerPassword').value;
        const confirmPassword = document.getElementById('registerConfirmPassword').value;

        if (password !== confirmPassword) {
            alert('–ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç!');
            return;
        }

        const users = JSON.parse(localStorage.getItem('users')) || [];
        const userExists = users.some(u => u.email === email);
        if (userExists) {
            alert('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —Ç–∞–∫–∏–º email —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç!');
            return;
        }

        const newUser = { name, email, password };
        users.push(newUser);
        localStorage.setItem('users', JSON.stringify(users));

        currentUser = newUser;
        localStorage.setItem('currentUser', JSON.stringify(currentUser));
        updateHeaderForUser();
        closeAuthModal();
        alert('–í—ã —É—Å–ø–µ—à–Ω–æ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–ª–∏—Å—å!');
    }

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã—Ö–æ–¥–∞
    function handleLogout() {
        localStorage.removeItem('currentUser');
        currentUser = null;
        updateHeaderForGuest();
        alert('–í—ã —É—Å–ø–µ—à–Ω–æ –≤—ã—à–ª–∏ –∏–∑ —Å–∏—Å—Ç–µ–º—ã!');
    }

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    document.addEventListener('DOMContentLoaded', function() {
        const userData = localStorage.getItem('currentUser');
        if (userData) {
            currentUser = JSON.parse(userData);
            updateHeaderForUser();
        } else {
            updateHeaderForGuest();
        }
        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –µ–≥–æ
        window.addEventListener('click', (event) => {
            const authModal = document.getElementById('authModal');
            if (event.target === authModal) closeAuthModal();
        });
    });
</script>
<script>
    // === 2. –ù–æ–≤–æ—Å—Ç–∏ –∏ –∏—Ö —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è ===
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –Ω–æ–≤–æ—Å—Ç–µ–π –ø–æ –¥–∞—Ç–µ
function filterNewsByDate() {
    const dateFilter = document.getElementById('dateFilter').value;
    const newsCards = document.querySelectorAll('.news-card');
    const today = new Date();
    today.setHours(0, 0, 0, 0); // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—Ä–µ–º—è –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è —Ç–æ–ª—å–∫–æ –¥–∞—Ç

    newsCards.forEach(card => {
        const dateElement = card.querySelector('.news-meta span:last-child');
        if (dateElement) {
            const newsDateStr = dateElement.textContent.trim();
            // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º —Å—Ç—Ä–æ–∫—É –¥–∞—Ç—ã –≤ –æ–±—ä–µ–∫—Ç Date (–Ω–∞–ø—Ä–∏–º–µ—Ä, "15 —è–Ω–≤–∞—Ä—è 2026" ‚Üí Date)
            const newsDate = parseRussianDate(newsDateStr);
            if (!newsDate) {
                card.style.display = 'none';
                return;
            }

            let shouldShow = true;
            switch (dateFilter) {
                case 'today':
                    shouldShow = isSameDay(newsDate, today);
                    break;
                case 'week':
                    const weekAgo = new Date(today);
                    weekAgo.setDate(today.getDate() - 7);
                    shouldShow = newsDate >= weekAgo && newsDate <= today;
                    break;
                case 'month':
                    const monthAgo = new Date(today);
                    monthAgo.setMonth(today.getMonth() - 1);
                    shouldShow = newsDate >= monthAgo && newsDate <= today;
                    break;
                case 'year':
                    const yearAgo = new Date(today);
                    yearAgo.setFullYear(today.getFullYear() - 1);
                    shouldShow = newsDate >= yearAgo && newsDate <= today;
                    break;
                default:
                    shouldShow = true;
            }
            card.style.display = shouldShow ? 'block' : 'none';
        }
    });
}

// –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ –¥–∞—Ç—ã –Ω–∞ —Ä—É—Å—Å–∫–æ–º (–Ω–∞–ø—Ä–∏–º–µ—Ä, "15 —è–Ω–≤–∞—Ä—è 2026")
function parseRussianDate(dateStr) {
    const months = {
        '—è–Ω–≤–∞—Ä—è': 0, '—Ñ–µ–≤—Ä–∞–ª—è': 1, '–º–∞—Ä—Ç–∞': 2, '–∞–ø—Ä–µ–ª—è': 3, '–º–∞—è': 4, '–∏—é–Ω—è': 5,
        '–∏—é–ª—è': 6, '–∞–≤–≥—É—Å—Ç–∞': 7, '—Å–µ–Ω—Ç—è–±—Ä—è': 8, '–æ–∫—Ç—è–±—Ä—è': 9, '–Ω–æ—è–±—Ä—è': 10, '–¥–µ–∫–∞–±—Ä—è': 11
    };

    const parts = dateStr.split(' ');
    if (parts.length !== 3) return null;

    const day = parseInt(parts[0], 10);
    const month = months[parts[1].toLowerCase()];
    const year = parseInt(parts[2], 10);

    if (isNaN(day) || month === undefined || isNaN(year)) return null;

    return new Date(year, month, day);
}

// –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è –¥–∞—Ç (–±–µ–∑ —É—á—ë—Ç–∞ –≤—Ä–µ–º–µ–Ω–∏)
function isSameDay(date1, date2) {
    return date1.getFullYear() === date2.getFullYear() &&
           date1.getMonth() === date2.getMonth() &&
           date1.getDate() === date2.getDate();
}
    // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤–æ—Å—Ç–µ–π –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
    function filterNews(category) {
        const newsCards = document.querySelectorAll('.news-card');
        newsCards.forEach(card => {
            const cardCategoryElement = card.querySelector('.news-meta span:first-child');
            if (cardCategoryElement) {
                const cardCategory = cardCategoryElement.textContent.trim();
                card.style.display = (category === '' || cardCategory === category) ? 'block' : 'none';
            }
        });
        // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–µ–Ω—é –ø–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ —Ñ–∏–ª—å—Ç—Ä–∞
        const menu = document.getElementById('menu');
        if (menu && menu.classList.contains('show')) menu.classList.remove('show');
    }
</script>
<script>
    // === 3. –ü–æ–≥–æ–¥–∞ –∏ –≤–∞–ª—é—Ç—ã ===
    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫—É—Ä—Å–∞ –≤–∞–ª—é—Ç
    async function updateCurrencyData() {
        try {
            const response = await fetch('https://www.cbr-xml-daily.ru/daily_json.js');
            const data = await response.json();
            const rates = {
                USD: data.Valute.USD.Value.toFixed(2),
                EUR: data.Valute.EUR.Value.toFixed(2),
                GBP: data.Valute.GBP.Value.toFixed(2),
                CNY: data.Valute.CNY.Value.toFixed(2)
            };
            document.getElementById('usdRate').textContent = `${rates.USD} RUB`;
            document.getElementById('eurRate').textContent = `${rates.EUR} RUB`;
            document.getElementById('gbpRate').textContent = `${rates.GBP} RUB`;
            document.getElementById('cnyRate').textContent = `${rates.CNY} RUB`;
            const date = new Date(data.Date.replace(/(\d+).(\d+).(\d+)/, '$3-$2-$1'));
            document.getElementById('currencyDate').textContent = `–î–∞–Ω–Ω—ã–µ –Ω–∞ ${date.toLocaleDateString('ru-RU')}`;
        } catch (error) {
            console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –∫—É—Ä—Å–∞ –≤–∞–ª—é—Ç:', error);
            alert('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –∫—É—Ä—Å—ã –≤–∞–ª—é—Ç.');
        }
    }

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–≥–æ–¥—ã —á–µ—Ä–µ–∑ –ø—Ä–æ–∫—Å–∏-—Å–µ—Ä–≤–µ—Ä
async function updateWeatherData() {
    const cities = [
        { name: '–ú–æ—Å–∫–≤–∞', id: 'moscowWeather', lat: 55.7558, lon: 37.6176 },
        { name: '–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥', id: 'spbWeather', lat: 59.9343, lon: 30.3351 },
        { name: '–ù–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫', id: 'novosibirskWeather', lat: 55.0084, lon: 82.9357 },
        { name: '–ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥', id: 'yekaterinburgWeather', lat: 56.8389, lon: 60.6057 }
    ];

    const date = new Date();
    document.getElementById('weatherDate').textContent = `–î–∞–Ω–Ω—ã–µ –Ω–∞ ${date.toLocaleDateString('ru-RU')} ${date.toLocaleTimeString('ru-RU', { hour: '2-digit', minute: '2-digit' })}`;

    for (const city of cities) {
        try {
            // –ó–∞–ø—Ä–æ—Å —á–µ—Ä–µ–∑ –ø—Ä–æ–∫—Å–∏-—Å–µ—Ä–≤–µ—Ä
            const response = await fetch(`/api/weather?lat=${city.lat}&lon=${city.lon}`);
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            const data = await response.json();

            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–≤–µ—Ç–∞
            const temp = Math.round(data.main.temp);
            const feelsLike = Math.round(data.main.feels_like);
            const description = data.weather[0].description;
            const emoji = getWeatherEmoji(data.weather[0].main);

            document.getElementById(city.id).innerHTML = `${temp}¬∞C, –æ—â—É—â–∞–µ—Ç—Å—è –∫–∞–∫ ${feelsLike}¬∞C, ${description} ${emoji}`;
        } catch (error) {
            console.error(`–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –ø–æ–≥–æ–¥—ã –¥–ª—è ${city.name}:`, error);
            document.getElementById(city.id).textContent = '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏';
        }
    }
}

    // –ü–æ–ª—É—á–µ–Ω–∏–µ —ç–º–æ–¥–∑–∏ –¥–ª—è –ø–æ–≥–æ–¥—ã
    function getWeatherEmoji(weather) {
        const emojis = {
            'Clear': '‚òÄÔ∏è', 'Clouds': '‚òÅÔ∏è', 'Rain': 'üåßÔ∏è', 'Drizzle': 'üå¶Ô∏è',
            'Thunderstorm': '‚õàÔ∏è', 'Snow': '‚ùÑÔ∏è', 'Mist': 'üå´Ô∏è',
            'Smoke': 'üå´Ô∏è', 'Haze': 'üå´Ô∏è', 'Fog': 'üå´Ô∏è'
        };
        return emojis[weather] || 'üå¶Ô∏è';
    }

    // –û—Ç–∫—Ä—ã—Ç–∏–µ/–∑–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω
    function openModal(modalId) {
        const modal = document.getElementById(`${modalId}Modal`);
        const menu = document.getElementById('menu');
        const authModal = document.getElementById('authModal');

        if (modal) modal.classList.add('show');
        if (menu && menu.classList.contains('show')) menu.classList.remove('show');
        if (authModal && authModal.classList.contains('show')) closeAuthModal();

        if (modalId === 'currency') updateCurrencyData();
        else if (modalId === 'weather') updateWeatherData();
    }

    function closeModal(modalId) {
        const modal = document.getElementById(`${modalId}Modal`);
        if (modal) modal.classList.remove('show');
    }
</script>

</body>
</html>
